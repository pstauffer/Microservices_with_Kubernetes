<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>README - Rob Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "README";
    var mkdocs_page_input_path = "12_Own_Gogs/README.md";
    var mkdocs_page_url = "/12_Own_Gogs/README/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Rob Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../README/">README</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>01 Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/Host_setup/">Host setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/Kubernetes_setup/">Kubernetes setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>02 First rest service</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/Deploy_in_Kubernetes/">Deploy in Kubernetes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/Dockerization/">Dockerization</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/JavaEE_service/">JavaEE service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>03 Docker registry</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../03_Docker_registry/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>04 Jenkins</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../04_Jenkins/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>05 Build and push ci step</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../05_Build_and_push_ci_step/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>06 Systemtest ci step</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Setup_test_env/">Setup test env</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Start_pipeline_on_every_push/">Start pipeline on every push</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Systemtest/">Systemtest</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>07 UI test</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../07_UI_test/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>08 Lasttest</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../08_Lasttest/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>09 Manual test</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../09_Manual_test/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>10 Canary release</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../10_Canary_release/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>11 Full production release</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../11_Full_production_release/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>12 Own Gogs</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">README</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#use-your-own-git-repository">Use your own Git repository</a></li>
                
                    <li><a class="toctree-l4" href="#create-folders-for-the-persistence">Create folders for the persistence</a></li>
                
                    <li><a class="toctree-l4" href="#kubernetes-deployment">Kubernetes deployment</a></li>
                
                    <li><a class="toctree-l4" href="#kubernetes-service">Kubernetes service</a></li>
                
                    <li><a class="toctree-l4" href="#disable-register">Disable register</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>13 Monitoring</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Dashboard/">Dashboard</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Prometheus/">Prometheus</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Weave_scope/">Weave scope</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>14 Documentation of rest service</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../14_Documentation_of_rest_service/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>15 Angular2 frontend</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../15_Angular2_frontend/First_view/">First view</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../15_Angular2_frontend/Initial_setup/">Initial setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../15_Angular2_frontend/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../15_Angular2_frontend/Test_and_prod_stage/">Test and prod stage</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>16 SSO with Keycloak</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Initial_setup_of_Keycloak/">Initial setup of Keycloak</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Secure_REST_service/">Secure REST service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Secure_frontend_service/">Secure frontend service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Setup_Keycloak/">Setup Keycloak</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>17 Event Sourcing with Cassandra</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/Changes_to_the_frontend/">Changes to the frontend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/REST_service_with_event_sourcing/">REST service with event sourcing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/Setup_Cassandra/">Setup Cassandra</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Mkdocs</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../mkdocs/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Rob Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>12 Own Gogs &raquo;</li>
        
      
    
    <li>README</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/robertBrem/Microservices_with_Kubernetes/edit/master/docs/12_Own_Gogs/README.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="use-your-own-git-repository">Use your own Git repository</h1>
<p>I prefer complex systems over complicated systems therefore I create a lot of repositories.
If you don't want to spam your GitHub account you can easily create an own 
<a href="https://gogs.io/">GoGs repository</a>.</p>
<h2 id="create-folders-for-the-persistence">Create folders for the persistence</h2>
<p>The GoGs repository has persistent data therefore we've to mount this data somewhere.
The easiest way to do that is over a node selector. A more advanced solution would be
to use GlusterFS, Flocker, NFS or something similar.</p>
<p>If we use node selectors for our persistence then we've to log in to the server
we want to persist the GoGs data.</p>
<pre><code>ssh root@5.189.154.24
</code></pre>

<p>On the server we've to create the folder structure that gets mounted to the host.</p>
<pre><code>mkdir -p gogs/data
</code></pre>

<h2 id="kubernetes-deployment">Kubernetes deployment</h2>
<p>To tell Kubernetes to schedule the GoGs repository pod on specified node we've to 
label the node:</p>
<pre><code>kc label nodes vmi71992.contabo.host name=vmi71992
</code></pre>

<p>Next we create a <code>deployment.yml</code> file <a href="https://gist.github.com/robertBrem/31b7ad46c8ee531c8dcd575989454825">like this one</a>.</p>
<pre><code>apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: gogs
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: gogs
    spec:
      containers:
      - resources:
        name: gogs
        image: gogs/gogs:0.9.97
        ports:
        - name: gogs-port
          containerPort: 3000
        volumeMounts:
        - mountPath: /data
          name: data
      volumes:
      - name: data
        hostPath:
          path: /root/gogs/data
      nodeSelector:
        name: vmi71992
</code></pre>

<p>This file has to be deployed:</p>
<pre><code>kc create -f deployment.yml
</code></pre>

<p>To test if the deployment is working you can display all pods:</p>
<pre><code>kc get po
</code></pre>

<pre><code>NAME                      READY     STATUS    RESTARTS   AGE
registry-95525520-9rdvc   1/1       Running   0          1m
</code></pre>

<h2 id="kubernetes-service">Kubernetes service</h2>
<p>To make the repository visible outside the cluster we have to create a Kubernetes service.
The <code>service.yml</code> file can be created similar to <a href="https://gist.github.com/robertBrem/68706f161388b7307bb0">this file</a>.</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: gogs
  labels:
    name: gogs
spec:
  ports:
  - port: 3001
    targetPort: 3000
    nodePort: 30130
  selector:
    name: gogs
  type: NodePort
</code></pre>

<p>To test the repository we can call the following url:</p>
<pre><code>http://disruptor.ninja:30130
</code></pre>

<h2 id="disable-register">Disable register</h2>
<p>After you have created your own user you better should disable the register
button. Otherwise everybody from the internet can create new users and repositories.
To disable registration you have to connect to into your Kubernetes pod.
To find the correct pod use this command:</p>
<pre><code>kc get po | grep gogs
</code></pre>

<pre><code>gogs-2819519451-kmpgj                       1/1       Running   0          1h
</code></pre>

<p>Now connect into the container inside this pod:</p>
<pre><code>kc exec -it gogs-2819519451-kmpgj bash
</code></pre>

<p>And open the following file:</p>
<pre><code>vi /data/gogs/conf/app.ini
</code></pre>

<p>Search for <code>DISABLE_REGISTRATION</code> set it to <code>true</code> and add 
<code>SHOW_REGISTRATION_BUTTON</code>:</p>
<pre><code>DISABLE_REGISTRATION   = true
SHOW_REGISTRATION_BUTTON = false
</code></pre>

<p>Now kill the running pod. Kubernetes will reschedule the GoGs and start it with
the new settings:</p>
<pre><code>kc delete pod gogs-2819519451-kmpgj
</code></pre>

<p>After the restart there is no more register button on the upper right next to
<code>Sign In</code>.</p>
<p><img alt="Without register button" src="../images/without_register.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../13_Monitoring/Dashboard/" class="btn btn-neutral float-right" title="Dashboard">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../11_Full_production_release/README/" class="btn btn-neutral" title="README"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/robertBrem/Microservices_with_Kubernetes" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../11_Full_production_release/README/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../13_Monitoring/Dashboard/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
