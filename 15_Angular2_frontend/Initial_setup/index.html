<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Initial setup - Rob Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Initial setup";
    var mkdocs_page_input_path = "15_Angular2_frontend/Initial_setup.md";
    var mkdocs_page_url = "/15_Angular2_frontend/Initial_setup/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Rob Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../README/">README</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>01 Setup</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/Host_setup/">Host setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/Kubernetes_setup/">Kubernetes setup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../01_Setup/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>02 First rest service</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/Deploy_in_Kubernetes/">Deploy in Kubernetes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/Dockerization/">Dockerization</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/JavaEE_service/">JavaEE service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../02_First_rest_service/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>03 Docker registry</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../03_Docker_registry/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>04 Jenkins</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../04_Jenkins/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>05 Build and push ci step</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../05_Build_and_push_ci_step/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>06 Systemtest ci step</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Setup_test_env/">Setup test env</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Start_pipeline_on_every_push/">Start pipeline on every push</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../06_Systemtest_ci_step/Systemtest/">Systemtest</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>07 UI test</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../07_UI_test/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>08 Lasttest</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../08_Lasttest/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>09 Manual test</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../09_Manual_test/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>10 Canary release</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../10_Canary_release/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>11 Full production release</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../11_Full_production_release/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>12 Own Gogs</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../12_Own_Gogs/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>13 Monitoring</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Dashboard/">Dashboard</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Prometheus/">Prometheus</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../13_Monitoring/Weave_scope/">Weave scope</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>14 Documentation of rest service</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../14_Documentation_of_rest_service/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>15 Angular2 frontend</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../First_view/">First view</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Initial setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#create-an-angular-2-frontend">Create an Angular 2 frontend</a></li>
                
                    <li><a class="toctree-l4" href="#install-nodejs-and-npm">Install NodeJS and NPM</a></li>
                
                    <li><a class="toctree-l4" href="#setup-the-angular-2-project">Setup the Angular 2 project</a></li>
                
                    <li><a class="toctree-l4" href="#create-a-docker-image">Create a Docker image</a></li>
                
                    <li><a class="toctree-l4" href="#create-the-jenkins-pipeline">Create the Jenkins pipeline</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Test_and_prod_stage/">Test and prod stage</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>16 SSO with Keycloak</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Initial_setup_of_Keycloak/">Initial setup of Keycloak</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Secure_REST_service/">Secure REST service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Secure_frontend_service/">Secure frontend service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../16_SSO_with_Keycloak/Setup_Keycloak/">Setup Keycloak</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>17 Event Sourcing with Cassandra</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/Changes_to_the_frontend/">Changes to the frontend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/REST_service_with_event_sourcing/">REST service with event sourcing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../17_Event_Sourcing_with_Cassandra/Setup_Cassandra/">Setup Cassandra</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Mkdocs</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../mkdocs/README/">README</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Rob Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>15 Angular2 frontend &raquo;</li>
        
      
    
    <li>Initial setup</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/robertBrem/Microservices_with_Kubernetes/edit/master/docs/15_Angular2_frontend/Initial_setup.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="create-an-angular-2-frontend">Create an Angular 2 frontend</h1>
<h2 id="install-nodejs-and-npm">Install NodeJS and NPM</h2>
<p>We're going to use NPM as our package manager. To install NodeJS and NPM execute the
following command:</p>
<pre><code>curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
sudo apt-get install -y nodejs
</code></pre>

<h2 id="setup-the-angular-2-project">Setup the Angular 2 project</h2>
<p>We are using a bootstrap project to get started with Angular 2:</p>
<pre><code>git clone --depth 1 https://github.com/angularclass/angular2-webpack-starter.git
cd angular2-webpack-starter
npm install
npm run server:dev:hmr
</code></pre>

<p>Now you can open the frontend on this url:</p>
<pre><code>http://localhost:3000
</code></pre>

<h2 id="create-a-docker-image">Create a Docker image</h2>
<p>If there isn't already a <code>Dockerfile</code> in the mail folder, create one with
the following settings:</p>
<pre><code>FROM nginx:latest

MAINTAINER Robert Brem &lt;brem_robert@hotmail.com&gt;

ADD dist/ /usr/share/nginx/html
</code></pre>

<p>Like the <code>jax-rs</code> service the Angular2 service needs a <code>build.js</code> script
to create and push the Docker image in the repository.</p>
<pre><code>#!/usr/bin/jjs -fv

var version = $ENV.VERSION;
var username = $ENV.REGISTRY_USERNAME;
var password = $ENV.REGISTRY_PASSWORD;
var email = $ENV.REGISTRY_EMAIL;

var registry = &quot;disruptor.ninja:30500&quot;;
var imageName = registry + &quot;/robertbrem/battleapp-frontend:&quot; + version;

var build = &quot;docker build -t &quot; + imageName + &quot; .&quot;;
execute(build);

var dockerLogin = &quot;docker login --username=&quot; + username + &quot; --password=&quot; + password + &quot; --email=&quot; + email + &quot; &quot; + registry;
execute(dockerLogin);

var push = &quot;docker push &quot; + imageName;
execute(push);

function execute(command) {
  $EXEC(command);
  print($OUT);
  print($ERR);
}
</code></pre>

<h2 id="create-the-jenkins-pipeline">Create the Jenkins pipeline</h2>
<p>First of all we've to install NodeJS and NPM on Jenkins.</p>
<p>On Jenkins go to <code>Manage Jenkins</code> <code>Manage Plugins</code>. Change to the 
<code>Available</code> tab and search for the <code>NodeJS Plugin</code> and install it.</p>
<p>After the restart go to <code>Manage Jenkins</code> <code>Global Tool Configuration</code>.<br />
Under the title <code>NodeJS</code> we make the following settings:</p>
<p><img alt="Install NodeJS" src="../images/install_nodejs.png" /></p>
<p>This installs NodeJS and NPM and we can use it in our pipeline.</p>
<p>The Angular2 sample project also allows us to statically analyze our code and
compares it with the official Angular2 style guide. We can include this
analysis in our pipeline with the <code>Checkstyle</code> plugin. Just search under
<code>Avaialble</code> plugins for <code>Checkstyle Plug-in</code> and install it.</p>
<pre><code>withEnv([   &quot;VERSION=1.0.${currentBuild.number}&quot;,
            &quot;KUBECTL=kubectl&quot;,
            &quot;REGISTRY_EMAIL=brem_robert@hotmail.com&quot;]) {

  stage &quot;checkout, build, test and publish&quot;
  node {
    git url: &quot;http://disruptor.ninja:30130/rob/battleapp-frontend&quot;
    def npmHome = tool 'NPM'
    env.PATH = &quot;${npmHome}/bin:${env.PATH}&quot;
    sh &quot;npm install&quot;
    sh &quot;npm run test&quot;
    sh &quot;npm run lint&quot;
    sh &quot;npm run build:prod&quot;
    sh &quot;./build.js&quot;
    step([$class: 'JUnitResultArchiver', testResults: '**TESTS-*.xml'])
    step([$class: 'hudson.plugins.checkstyle.CheckStylePublisher', pattern: '**REPORTS-*.xml'])
  }
</code></pre>

<p>That the Karma tests can be executed on the server we've to change the
Karma settings from using Chrome to using PhantomJS. Therefore we've to change
the browser in <code>karma.conf.js</code>:</p>
<pre><code>...
browsers: [
  'PhantomJS'
],
...
</code></pre>

<p>PhantomJS is not per default installed therefore we've to install it:</p>
<pre><code>npm install --save-dev karma-phantomjs-launcher
</code></pre>

<p>That Jenkins understands the test results we've to install the 
<code>karma-junit-reporter</code>:</p>
<pre><code>npm install karma-junit-reporter --save-dev
</code></pre>

<p>And tell Angular2 to create a report. This have to be done in the
<code>karma.conf.js</code> as well:</p>
<pre><code>...
reporters: ['mocha', 'coverage', 'remap-coverage', 'junit'],

junitReporter: {
  outputDir: '', // results will be saved as $outputDir/$browserName.xml
  outputFile: undefined, // if included, results will be saved as $outputDir/$browserName/$outputFile
  suite: '', // suite will become the package name attribute in xml testsuite element
  useBrowserName: true, // add browser name to report and classes names
  nameFormatter: undefined, // function (browser, result) to customize the name attribute in xml testcase element
  classNameFormatter: undefined, // function (browser, result) to customize the classname attribute in xml testcase element
  properties: {} // key value pair of properties to add to the &lt;properties&gt; section of the report
},
...
</code></pre>

<p>That Jenkins understands the static analysis we've to adapt the <code>lint</code> 
npm script:</p>
<pre><code>&quot;lint&quot;: &quot;tslint --format tslint-checkstyle-reporter -o REPORTS-tslint.xml --force \&quot;src/**/*.ts\&quot; &amp;&amp; ./createCheckstyle.sh&quot;,
</code></pre>

<p>And install the <code>tslint-checkstyle-reporter</code>:</p>
<pre><code>npm install tslint-checkstyle-reporter --save-dev
</code></pre>

<p>Additionally we've to create a script that adds the xml header and footer for
the Checkstyle plugin. This script is created in the root folder with the
name <code>createCheckstyle.sh</code>:</p>
<pre><code># /bin/bash

sed -i &quot;1s/^/&lt;?xml version='1.0' encoding='utf-8'?&gt;\n&lt;checkstyle version='5.7'&gt;\n/&quot; REPORTS-tslint.xml
echo &quot;&lt;/checkstyle&gt;&quot; &gt;&gt; REPORTS-tslint.xml
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../README/" class="btn btn-neutral float-right" title="README">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../First_view/" class="btn btn-neutral" title="First view"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/robertBrem/Microservices_with_Kubernetes" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../First_view/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../README/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
